<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Insecurity Indicators</title>
    <base target="_top">        
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="crossorigin=""></script>  
    

    <script src="./ChoroplethData/js/overallHunger.js"></script>
    <script src="./ChoroplethData/js/childHunger.js"></script>
    <script src="./ChoroplethData/js/disability.js"></script>
    <script src="./ChoroplethData/js/education.js"></script>
    <script src="./ChoroplethData/js/incomeBlackDif.js"></script>
    <script src="./ChoroplethData/js/incomeLatDif.js"></script>
    <script src="./ChoroplethData/js/mealCost.js"></script>
    <script src="./ChoroplethData/js/poverty.js"></script>
    <script src="./ChoroplethData/js/raceEth.js"></script>
    <script src="./ChoroplethData/js/unemployment.js"></script>
    <script src="./PointData/SNAP.js"></script>


    <style>
        h1 {
        font-family:'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        font-size: 36px;
        position: relative;
        top: 10%;
        text-align: center;
        outline-style: ridge;
        -webkit-text-stroke-width: 1px;
        }
        h2 {
            font-family:'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        }
        h3 {
            font-family:'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
        }
        .legend {
            line-height: 18px;
            color: #000;
            background-color: #ffffff;
        }
        .legend i {
            width: 18px;
            height: 18px;
            float: left;
            margin-right: 8px;
            opacity: 0.7; 
        }
        #map { height: 400px;
            width: 900px;
            background-color: lightslategray;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Underlying Food Insecurity Indicators</h1>
    <h2 id="theYear">Year</h2>

        <input type="range" name="year" value="2010" min="2010" max="2020" oninput="moveSlider(this.value)">
        <div id="map"></div>
        <div class="legend"></div>

    <script>
        var map = L.map('map').setView([35.264919, -79.759003], 7);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap'
        }).addTo(map);

        // OVERALL HUNGER //
        var selectedYear = '2010'

        function myStyleOH(feature) {
            return {
            "fillColor": getColorOH(feature.properties[selectedYear]),
            "color": "black",
            "weight": 0.75,
            "opacity": 2.0,
            "fillOpacity": 0.75
            }};
        function getColorOH(colorScaleOH) {
            return colorScaleOH < 10 ? "#238b45" 
            :colorScaleOH < 15 ? "#ffffb2" 
            :colorScaleOH < 20 ? "#fd8d3c"
            : '#e31a1c';
            };

        var overallHungerRate = L.geoJSON(overallHunger, {style: myStyleOH}).addTo(map);

        function moveSlider(value) {
            selectedYear = value;
            overallHungerRate.remove()
            overallHungerRate = L.geoJSON(overallHunger, {style: myStyleOH}).addTo(map);
            document.getElementById('theYear').innerHTML = 'Year: '+ value  
            };
        // legend
        // var legendOH = L.control({position: 'bottomright'});
        //         legendOH.onAdd = function (map) {
        //             var div = L.DomUtil.create('div', 'info legend'),
        //                 grades = [0, 10, 15, 20],
        //                 labels = [];

        //             for (var i = 0; i < grades.length; i++) {
        //                 div.innerHTML +=
        //                     '<i style="background:' + getColor(grades[i] + 1) + '"></i> ' +
        //                     grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + ' gal'+ '<br>' : '+ gal');
        //             }
        //             return div;
        //         };
        //         legendOH.addTo(map);
    // CHILD HUNGER //
        function myStyleCH(feature) {

            return {
            "fillColor": getColorCH(feature.properties[selectedYear]),
            "color": "black",
            "weight": 0.75,
            "opacity": 2.0,
            "fillOpacity": 0.7
            }};

        function getColorCH(colorScaleCH) {
            return colorScaleCH < 15 ? "#238b45" 
            :colorScaleCH < 20 ? "#ffffb2" 
            :colorScaleCH < 25 ? "#fd8d3c"
            : '#e31a1c';
        };

        var childHungerRate = L.geoJSON(childHunger, {style: myStyleCH}).addTo(map);

        function moveSlider(value) {
            selectedYear = value;
            // Remove geojson
            childHungerRate.remove()
            // new geojson
            childHungerRate = L.geoJSON(childHunger, {style: myStyleCH}).addTo(map);
            document.getElementById('theYear').innerHTML = 'Year: '+ value  
        }

        //  MEAL COST
        function myStyleMC(feature) {

            return {
            "fillColor": getColorMC(feature.properties[selectedYear]),
            "color": "black",
            "weight": 0.75,
            "opacity": 2.0,
            "fillOpacity": 0.7
            }
            };
            function getColorMC(colorScaleMC) {
            return colorScaleMC < 2 ? "#238b45" 
            :colorScaleMC < 2.33 ? "#ffffb2" 
            :colorScaleMC < 2.66 ? "#fd8d3c"
            : '#e31a1c';
            };

            var mealCostRate = L.geoJSON(mealCost, {style: myStyleMC}).addTo(map);

            function moveSlider(value) {
            selectedYear = value;
            mealCostRate.remove()
            mealCostRate = L.geoJSON(mealCost, {style: myStyleMC}).addTo(map);
            document.getElementById('theYear').innerHTML = 'Year: '+ value  
            }

        // DISABILITY
        function myStyleD(feature) {

            return {
            "fillColor": getColorD(feature.properties[selectedYear]),
            "color": "black",
            "weight": 0.75,
            "opacity": 2.0,
            "fillOpacity": 0.7
            }
            };
            function getColorD(colorScaleD) {
            return colorScaleD < 10 ? "#238b45" 
            :colorScaleD < 15 ? "#ffffb2" 
            :colorScaleD < 20 ? "#fd8d3c"
            : '#e31a1c';
            };

            var disabilityRate = L.geoJSON(disability, {style: myStyleD}).addTo(map);

            function moveSlider(value) {
            selectedYear = value;
            disabilityRate.remove()
            disabilityRate = L.geoJSON(disability, {style: myStyleD}).addTo(map);
            document.getElementById('theYear').innerHTML = 'Year: '+ value  
            }
        // EDUCATIONAL ATTAINMENT LESS THAN HIGH SCHOOL DIPLOMA OR GED //
        function myStyleE(feature) {

            return {
            "fillColor": getColorE(feature.properties[selectedYear]),
            "color": "black",
            "weight": 0.75,
            "opacity": 2.0,
            "fillOpacity": 0.7
            }};
            function getColorE(colorScaleE) {
            return colorScaleE < 10 ? "#238b45" 
            :colorScaleE < 15 ? "#ffffb2" 
            :colorScaleE < 20 ? "#fd8d3c"
            : '#e31a1c';
            };

            var educationRate = L.geoJSON(education, {style: myStyleE}).addTo(map);

            function moveSlider(value) {
            selectedYear = value;
            educationRate.remove()
            educationRate = L.geoJSON(education, {style: myStyleE}).addTo(map);
            document.getElementById('theYear').innerHTML = 'Year: '+ value  
            }
        // // MEDIAN HH INCOME DIFFERENCE BETWEEN WHITE AND LATINO //
        function myStyleIL(feature) {

            return {
            "fillColor": getColorIL(feature.properties[selectedYear]),
            "color": "black",
            "weight": 0.75,
            "opacity": 2.0,
            "fillOpacity": 0.7
            }
            };
            function getColorIL(colorScaleIL) {
            return colorScaleIL < 10000 ? "#238b45" 
            :colorScaleIL < 15000 ? "#ffffb2" 
            :colorScaleIL < 20000 ? "#fd8d3c"
            : '#e31a1c';
            };

            var incomeLatDifRate = L.geoJSON(incomeLatDif, {style: myStyleIL}).addTo(map);

            function moveSlider(value) {
            selectedYear = value;
            incomeLatDifRate.remove()
            incomeLatDifRate = L.geoJSON(incomeLatDif, {style: myStyleIL}).addTo(map);
            document.getElementById('theYear').innerHTML = 'Year: '+ value  
            }
        // // MEDIAN HH INCOME DIFFERENCE BETWEEN WHITE AND BLACK POPULATION //
        function myStyleIB(feature) {

            return {
            "fillColor": getColorIB(feature.properties[selectedYear]),
            "color": "black",
            "weight": 0.75,
            "opacity": 2.0,
            "fillOpacity": 0.7
            }
            };
            function getColorIB(colorScaleIB) {
            return colorScaleIB < 10000 ? "#238b45" 
            :colorScaleIB < 15000 ? "#ffffb2" 
            :colorScaleIB < 20000 ? "#fd8d3c"
            : '#e31a1c';
            };

            var incomeBlackDifRate = L.geoJSON(incomeBlackDif, {style: myStyleIB}).addTo(map);

            function moveSlider(value) {
            selectedYear = value;
            incomeBlackDifRate.remove()
            incomeBlackDifRate = L.geoJSON(incomeBlackDif, {style: myStyleIB}).addTo(map);
            document.getElementById('theYear').innerHTML = 'Year: '+ value  
            }

        // // POVERTY //
        function myStyleP(feature) {

            return {
            "fillColor": getColorP(feature.properties[selectedYear]),
            "color": "black",
            "weight": 0.75,
            "opacity": 2.0,
            "fillOpacity": 0.7
            }
            };
            function getColorP(colorScaleP) {
            return colorScaleP < 10 ? "#238b45" 
            :colorScaleP < 15 ? "#ffffb2" 
            :colorScaleP < 20 ? "#fd8d3c"
            : '#e31a1c';
            };

            var povertyRate = L.geoJSON(poverty, {style: myStyleP}).addTo(map);

            function moveSlider(value) {
            selectedYear = value;
            povertyRate.remove()
            povertyRate = L.geoJSON(poverty, {style: myStyleP}).addTo(map);
            document.getElementById('theYear').innerHTML = 'Year: '+ value  
            }

        // // RACE AND ETHINICITY //
        function myStyleRE(feature) {

            return {
            "fillColor": getColorRE(feature.properties[selectedYear]),
            "color": "black",
            "weight": 0.75,
            "opacity": 2.0,
            "fillOpacity": 0.7
            }
            };
            function getColorRE(colorScaleRE) {
            return colorScaleRE < 15 ? "#238b45" 
            :colorScaleRE < 25 ? "#ffffb2" 
            :colorScaleRE < 35 ? "#fd8d3c"
            : '#e31a1c';
            };

            var raceEthRate = L.geoJSON(raceEth, {style: myStyleRE}).addTo(map);

            function moveSlider(value) {
            selectedYear = value;
            raceEthRate.remove()
            raceEthRate = L.geoJSON(raceEth, {style: myStyleRE}).addTo(map);
            document.getElementById('theYear').innerHTML = 'Year: '+ value  
            }
        // // UNEMPLOYMENT //
        function myStyleU(feature) {

            return {
            "fillColor": getColorU(feature.properties[selectedYear]),
            "color": "black",
            "weight": 0.75,
            "opacity": 2.0,
            "fillOpacity": 0.7
            }
            };
            function getColorU(colorScaleU) {
            return colorScaleU < 10 ? "#238b45" 
            :colorScaleU < 15 ? "#ffffb2" 
            :colorScaleU < 20 ? "#fd8d3c"
            : '#e31a1c';
            };

            var unemploymentRate = L.geoJSON(unemployment, {style: myStyleU}).addTo(map);

            function moveSlider(value) {
            selectedYear = value;
            unemploymentRate.remove()
            unemploymentRate = L.geoJSON(unemployment, {style: myStyleU}).addTo(map);
            document.getElementById('theYear').innerHTML = 'Year: '+ value  
            }
        moveSlider('2010')

    // Food Bank markers manually created
    var foodBanks = L.layerGroup().addTo(map);
  
    var mannaFB = L.marker([35.57501, -82.501873]).bindPopup('MANNA Food Bank').addTo(foodBanks);
    var secHarvMet = L.marker([35.239401, -80.837983]).bindPopup('Second Harvest Food Bank of Metrolina').addTo(foodBanks);
    var FBAbermarle = L.marker([36.285388, -76.213284]).bindPopup('Food Bank of the Abermarle').addTo(foodBanks);
    var secHarvSE = L.marker([35.034307, -78.908828]).bindPopup('Second Harvest of Southeast NC').addTo(foodBanks);
    var FBCE = L.marker([35.831161, -78.607644]).bindPopup('Food Bank of Central and Eastern NC').addTo(foodBanks);
    var IFFS = L.marker([35.689086, -78.675118]).bindPopup('Inter-Faith Food Shuttle').addTo(foodBanks);
    var secHarvNW = L.marker([36.053473, -80.207308]).bindPopup('Second Harvest of Northwest NC').addTo(foodBanks);

    // SNAP Markers (Make marker clusters)
    // L.geoJSON(SNAP).addTo(map);

//   Add layers to map //
    var choropleths = {
        // 'Food Insecurity Rate': overallHungerRate,
        // 'Child Food Insecurity Rate': childHungerRate,
        // 'Average Meal Cost': mealCostRate,
        // 'Disability Status': disabilityRate,
        // 'Education Attainment: Less than high school diploma': mealCostRate,
        // 'Household Income Difference: White - Latino': incomeLatDifRate,
        // 'Household Income Difference: White - Black': incomeBlackDifRate,
        'Poverty Rate': povertyRate,
        // 'Ethnic Minority Rate': raceEthRate,
        'Unemployment Rate': unemploymentRate
    };
    var pointVectors = {
        'Food Banks': foodBanks,
        // 'SNAP Retailers': snapRetailers
    }
  
    var layerControl = L.control.layers(choropleths, pointVectors).addTo(map);
    // map.removeLayer(overallHungerRate)

    map.on('baselayerchange', onOverlayAdd);

    function onOverlayAdd(e){
    currentLayer = e.layer;
    document.getElementsByClassName('legend').innerHTML = e.name
    }
var currentLayer = undefined

    </script>
</body>
</html>